import{r as e,o as t,d as s,f as a,e as o,t as r,c as n,v as i,a as l,i as c}from"./Dciesp7g.js";import{a as u}from"./CdRfmGFb.js";import{d}from"./BrwdHZOY.js";const p=u.create({headers:{Accept:"application/json","Content-Type":"application/json"},timeout:5e4});p.interceptors.request.use((e=>((e.headers||{}).isToken,e.headers["User-Agent"]="Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:122.0) Gecko/20100101 Firefox/122.0",e)),(e=>Promise.reject(e))),p.interceptors.response.use((function(e){if("blob"===e.request.responseType||"arraybuffer"===e.request.responseType)return e.data;const t=e.data.code||200;switch(t){case 400:case 401:return Promise.reject(`無法存取:${t}, status:${e.status}`);case 404:return Promise.reject("頁面不存在:404");case 500:return Promise.reject("內部發生錯誤")}return e.data}),(function(e){return e.response&&e.response.status,Promise.reject(e.response)}));const f={class:"container-fluid",style:{margin:"0",padding:"0"}},m={class:"d-flex flex-wrap justify-content-center gap-2 w-100",style:{padding:"20px"}},g={class:"card card-fixed-wd"},v={class:"card-img-top"},y=["src"],h={class:"card-body"},w={key:0,class:"list-group list-group-flush"},b={key:0,class:"list-group-item"},x={key:1,class:"list-group-item",style:{color:"red"}},j={class:"list-group-item"},k={class:"list-group-item"},C={class:"card-footer d-flex flex-wrap justify-content-center"},P={__name:"CheckIn",setup(u){const p=l(),P=e(!1),$=e({lat:25.03418,lng:121.564087}),T=e("https://maps.google.com/maps?q=25.034180679449104,121.56408708529044&output=embed"),q=e(""),z=e("");function S(){P.value=!1,q.value="資料獲取中...","geolocation"in navigator?navigator.geolocation.getCurrentPosition((e=>{const t=Math.round(1e6*e.coords.latitude)/1e6,s=Math.round(1e6*e.coords.longitude)/1e6;$.value={lat:t,lng:s},T.value=`https://maps.google.com/maps?q=${t},${s}&output=embed`,q.value=""}),(e=>{n.warn(`無法取得位置資訊${e.code} ${e.message||""}`,{autoClose:4e3}),q.value="無法取得位置資訊"})):(n.warn("您的瀏覽器不支援地理定位功能。",{autoClose:4e3}),q.value="您的瀏覽器不支援地理定位功能"),new Promise((async(e,t)=>{try{const t=await fetch("https://api.ipify.org?format=json");e((await t.json()).ip)}catch(s){t(s.message||s.code)}})).then((e=>{z.value=e})).catch((e=>{z.value="error"})).finally((()=>{P.value=!0}))}return t((async()=>{})),(e,t)=>(c(),s("div",f,[a("div",m,[a("div",g,[a("div",v,[T.value.length>5?(c(),s("iframe",{key:0,width:"100%",height:"240",style:{border:"0"},loading:"lazy",allowfullscreen:"",referrerpolicy:"no-referrer-when-downgrade",src:T.value},null,8,y)):o("",!0)]),a("div",h,[t[3]||(t[3]=a("h4",{class:"card-title"},"打卡資訊",-1)),P.value?(c(),s("ul",w,[0==q.value.length?(c(),s("li",b,"GPS: "+r($.value.lat)+","+r($.value.lng),1)):o("",!0),q.value.length>0?(c(),s("li",x,"GPS: "+r(q.value),1)):o("",!0),a("li",j,"IP: "+r(z.value),1),a("li",k,[a("button",{type:"button",class:"btn btn-outline-primary fixed-size me-2",onClick:t[0]||(t[0]=e=>{window.Swal.fire({icon:"question",title:"送出打卡資訊",showDenyButton:!0,confirmButtonText:"確認",denyButtonText:"取消"}).then((e=>{if(e.isConfirmed){let e={location:[$.value.lat,$.value.lng],myip:z.value,ts:parseInt(Date.now()/1e3)};d(e).then((e=>{e.data.svts?(n.success("打卡成功",{autoClose:3e3}),liff.isLoggedIn()&&liff.sendMessages([{type:"text",text:"今日打卡資訊"}]).then((function(e){})).catch((function(e){}))):Swal.fire({title:"打卡失敗",icon:"error",text:`${e.error} ${e.extra.mesg||""}`})})).catch((e=>{Swal.fire({title:"打卡失敗，請再試一次",icon:"error"})}))}else e.isDenied}))})},"送出")])])):o("",!0)]),a("div",C,[a("button",{type:"button",class:"btn btn-outline-primary fixed-size me-2",onClick:t[1]||(t[1]=e=>S())},"打卡"),a("button",{type:"button",class:"btn btn-outline-primary fixed-size me-2",onClick:t[2]||(t[2]=e=>{i((()=>{p.push({name:"Home"})}))})},"回首頁")])])])]))}};export{P as default};
