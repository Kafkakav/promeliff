import{_ as e,u as a,r as s,o as l,l as t,a as o,b as n,c as i,d as r,e as c,f as d,w as f,g,t as u,h as m,i as p}from"./oj9_mtiD.js";import{_ as y}from"./BIwg1ykr.js";import{s as h}from"./Da2dY_mR.js";const I="/promeliff/assets/BmIlvr5V.jpg";const v={class:"login"},L={key:0,class:"card"},k={key:1,class:"card"},b={class:"card-footer text-body-secondary"},C={key:0},x={key:1},E={key:2,class:"card"},R={class:"logo-banner"},w=e({__name:"lifflogin",setup(e){const w=a(),N=o(),T=s(null),j=s(!1),F=s(0),D=s("https://liff.line.me/2003978054-MNlNVly1");function O(e){if(!w.liffReady)return t.init({liffId:w.liffId}).then((()=>{})).catch((e=>{})),t.ready}function B(){let e=m("stepExtLogin");e&&911==e.yes?F.value=1:F.value=2}const P=()=>{if(w.fullscLoading=!0,w.liffReady)if(t.isInClient())t.isLoggedIn()?(handleGASDID(),N.push({name:"Home"})):O();else if(t.isLoggedIn())handleGASDID(),N.push({name:"Home"});else{j.value=!0;let e="";null!=w.replyQry&&(e="&replyQry=",e+=encodeURIComponent(JSON.stringify(w.replyQry))),t.login({redirectUri:`${w.liffEPUrl}?login=ext${e}`}),j.value=!1}else O()},H=()=>new Promise(((e,a)=>{let s={liffId:w.liffId,accessToken:t.getAccessToken(),idToken:t.getIDToken()};var l;t.isLoggedIn(),(l=s,h({url:"/WdaG8atCBY/getoken",headers:{isToken:!1},method:"post",data:l})).then((s=>s.data&&s.data.token?(i("授權取得成功",{autoClose:4e3}),e(s.data)):(i("授權無法取得",{autoClose:4e3}),a({error:"no token acquired"})))).catch((e=>(w.liffReady=!1,i("授權失敗, 請關閉頁面",{autoClose:4e3}),a({error:"failed to get token"}))))}));return l((()=>{t.isLoggedIn()?H().then((e=>{w.setAuthToken(e),N.push({name:"Home"})})).catch((e=>{w.setAuthToken({token:"Fake-H99saGoCjD7ngi26sluCbzoSNLONBP8asx2abq2hfoENgK6n1mq4YuXJFAOnGRJC"}),N.push({name:"Home"})})).finally((()=>{B(),w.fullscLoading=!1})):(B(),w.fullscLoading=!1)})),n((()=>{w.fullscLoading=!0,w.liffReady||(O(),w.liffReady=!0),t.isInClient()?t.isLoggedIn()||window.Swal.fire({icon:"warning",title:"無法登入",text:"LINE LIFF 無法登入!",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"再試一次",denyButtonText:"關閉"}).then((e=>{e.isConfirmed?N.push({name:"Login"}):e.isDenied&&i("LINE LIFF 登入失敗",{autoClose:2e3})})):i("LINE LIFF 外部瀏覽器",{autoClose:2e3})})),(e,a)=>(p(),r("div",v,[0==F.value?(p(),r("div",L,a[1]||(a[1]=[d("img",{src:y,class:"card-img-top",alt:"PROME Title"},null,-1),d("p",{class:"logo-banner"},[d("img",{class:"object-fit-sm-contain border rounded-circle",style:{"max-width":"240px"},src:I,alt:"PROME Lion"})],-1)]))):c("",!0),1==F.value?(p(),r("div",k,[a[2]||(a[2]=d("img",{src:y,class:"card-img-top",alt:"PROME Title"},null,-1)),a[3]||(a[3]=d("div",{class:"card-body"},[d("h3",{class:"card-title"},[d("p",null,"訪問網站需要登入LINE，點選登入按鈕後繼續...")])],-1)),d("form",{class:"login-form",ref_key:"loginRef",ref:T,onSubmit:a[0]||(a[0]=f((()=>{}),["prevent"])),size:"large"},[d("p",{class:"logo-banner"},[d("img",{class:"imgbtn",src:"/promeliff/assets/CFYjjMVw.png",onClick:P,alt:"LIFF Login"})])],544),d("div",b,[j.value?(p(),r("span",x,"登 入 中 ...")):(p(),r("span",C,"請先登入"))])])):c("",!0),2==F.value?(p(),r("div",E,[a[4]||(a[4]=g('<img src="'+y+'" class="card-img-top" alt="PROME Title" data-v-42a61f5f><div class="d-flex flex-wrap justify-content-center" data-v-42a61f5f><p class="logo-banner" data-v-42a61f5f><img class="object-fit-sm-contain border rounded-circle" style="max-width:220px;" src="'+I+'" alt="PROME Lion" data-v-42a61f5f></p><p class="logo-banner" data-v-42a61f5f><img class="object-fit-sm-contain" style="max-width:220px;" src="/promeliff/assets/DHGIH-dO.png" alt="LINEBot:@poi1124d" data-v-42a61f5f></p></div><h3 class="logo-banner" data-v-42a61f5f>請用LINE掃QR Code加好友或在LINE聊天室裡開啟本網頁</h3>',3)),d("p",R,u(D.value),1)])):c("",!0)]))}},[["__scopeId","data-v-42a61f5f"]]);export{w as default};
