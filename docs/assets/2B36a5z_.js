import{g as e,_ as s,u as a,r as t,o,l as n,a as r,b as i,c as l,d as c,e as d,f as u,w as f,h as m,t as g,i as p,j as h}from"./njhQfitb.js";import{_ as v}from"./BIwg1ykr.js";import{a as y}from"./fZjk1EK6.js";const L="/promeliff/assets/BmIlvr5V.jpg",I={401:"認證失敗，無法存取系統資源:401",403:"當前操作沒有權限:403",404:"存取資源不存在:404",default:"未知系統錯誤，請向管理員反應問題"};let b={show:!1};y.defaults.headers["Content-Type"]="application/json;charset=utf-8";const k=y.create({baseURL:"https://nozomiai.asuscomm.com/promeliff",timeout:12e3});k.interceptors.request.use((s=>(!(!1===(s.headers||{}).isToken)&&e()&&(s.headers.Authorization="Bearer "+e()),s)),(e=>{Promise.reject(e)})),k.interceptors.response.use((e=>{const s=e.data.code||200,a=I[s]||e.data.msg||I.default;return"blob"===e.request.responseType||"arraybuffer"===e.request.responseType?e.data:401===s?b.show?Promise.reject({error:"無效的session，或者會話已過期，請重新登錄。",code:s}):void(b.show=!0):500===s?Promise.reject(new Error(a)):200!==s?Promise.reject({error:"unknown error",code:s}):e.data}),(e=>{let s="x",{message:a}=e;return"Network Error"==a?a="後端連線異常":a.includes("timeout")?a="系統請求超時":a.includes("Request failed with status code")&&(s=a.substr(a.length-3),a=`系統${s}異常`),["400","403","404"].indexOf(s),e.response?Promise.reject({error:a,data:e.response.data||null,code:e.response.status||s}):Promise.reject(e)}));const w={class:"login"},j={key:0,class:"card"},x={key:1,class:"card"},C={class:"card-footer text-body-secondary"},E={key:0},T={key:1},R={key:2,class:"card"},P={class:"logo-banner"},N=s({__name:"lifflogin",setup(e){const s=a(),y=r(),I=t(null),b=t(!1),N=t(0),F=t("https://liff.line.me/2003978054-MNlNVly1");function B(e){if(!s.liffReady)return n.init({liffId:s.liffId}).then((()=>{})).catch((e=>{})),n.ready}function O(){let e=p("stepExtLogin");e&&911==e.yes?N.value=1:N.value=2}const q=()=>{s.fullscLoading=!0,s.liffReady?n.isInClient()?n.isLoggedIn()?y.push({name:"Home"}):B():n.isLoggedIn()?y.push({name:"Home"}):(b.value=!0,n.login({redirectUri:`${s.liffEPUrl}?longin=1`}),b.value=!1):B()},H=()=>new Promise(((e,a)=>{let t={liffId:s.liffId,accessToken:n.getAccessToken(),idToken:n.getIDToken()};var o;n.isLoggedIn(),(o=t,k({url:"/WdaG8atCBY/getoken",headers:{isToken:!1},method:"post",data:o})).then((s=>s.data&&s.data.token?(l("授權取得成功",{autoClose:4e3}),e(s.data)):(l("授權無法取得",{autoClose:4e3}),a({error:"no token acquired"})))).catch((e=>(s.liffReady=!1,l("授權失敗, 請關閉頁面",{autoClose:4e3}),a({error:"failed to get token"}))))}));return o((()=>{n.isLoggedIn()?H().then((e=>{s.setAuthToken(e),y.push({name:"Home"})})).catch((e=>{s.setAuthToken({token:"Fake-H99saGoCjD7ngi26sluCbzoSNLONBP8asx2abq2hfoENgK6n1mq4YuXJFAOnGRJC"}),y.push({name:"Home"})})).finally((()=>{O(),s.fullscLoading=!1})):(O(),s.fullscLoading=!1)})),i((()=>{s.fullscLoading=!0,s.liffReady||(B(),s.liffReady=!0),n.isInClient()?n.isLoggedIn()||window.Swal.fire({icon:"warning",title:"無法登入",text:"LINE LIFF 無法登入!",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"再試一次",denyButtonText:"關閉"}).then((e=>{e.isConfirmed?y.push({name:"Login"}):e.isDenied&&l("LINE LIFF 登入失敗",{autoClose:2e3})})):l("LINE LIFF 外部瀏覽器",{autoClose:2e3})})),(e,s)=>(h(),c("div",w,[0==N.value?(h(),c("div",j,s[1]||(s[1]=[u("img",{src:v,class:"card-img-top",alt:"PROME Title"},null,-1),u("p",{class:"logo-banner"},[u("img",{class:"object-fit-sm-contain border rounded-circle",style:{"max-width":"240px"},src:L,alt:"PROME Lion"})],-1)]))):d("",!0),1==N.value?(h(),c("div",x,[s[2]||(s[2]=u("img",{src:v,class:"card-img-top",alt:"PROME Title"},null,-1)),s[3]||(s[3]=u("div",{class:"card-body"},[u("h3",{class:"card-title"},[u("p",null,"訪問網站需要登入LINE，點選登入按鈕後繼續...")])],-1)),u("form",{class:"login-form",ref_key:"loginRef",ref:I,onSubmit:s[0]||(s[0]=f((()=>{}),["prevent"])),size:"large"},[u("p",{class:"logo-banner"},[u("img",{class:"imgbtn",src:"/promeliff/assets/CFYjjMVw.png",onClick:q,alt:"LIFF Login"})])],544),u("div",C,[b.value?(h(),c("span",T,"登 入 中 ...")):(h(),c("span",E,"請先登入"))])])):d("",!0),2==N.value?(h(),c("div",R,[s[4]||(s[4]=m('<img src="'+v+'" class="card-img-top" alt="PROME Title" data-v-6818a744><div class="d-flex flex-wrap justify-content-center" data-v-6818a744><p class="logo-banner" data-v-6818a744><img class="object-fit-sm-contain border rounded-circle" style="max-width:220px;" src="'+L+'" alt="PROME Lion" data-v-6818a744></p><p class="logo-banner" data-v-6818a744><img class="object-fit-sm-contain" style="max-width:220px;" src="/promeliff/assets/DHGIH-dO.png" alt="LINEBot:@poi1124d" data-v-6818a744></p></div><h3 class="logo-banner" data-v-6818a744>請用LINE掃QR Code加好友或在LINE聊天室裡開啟本網頁</h3>',3)),u("p",P,g(F.value),1)])):d("",!0)]))}},[["__scopeId","data-v-6818a744"]]);export{N as default};
