import{x as e,r as t,o as s,d as a,f as o,e as r,t as n,c as i,y as l,a as c,j as u}from"./BpdCzYEz.js";import{d}from"./DVot81TO.js";const p=e.create({headers:{Accept:"application/json","Content-Type":"application/json"},timeout:5e4});p.interceptors.request.use((e=>((e.headers||{}).isToken,e.headers["User-Agent"]="Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:122.0) Gecko/20100101 Firefox/122.0",e)),(e=>Promise.reject(e))),p.interceptors.response.use((function(e){if("blob"===e.request.responseType||"arraybuffer"===e.request.responseType)return e.data;const t=e.data.code||200;switch(t){case 400:case 401:return Promise.reject(`無法存取:${t}, status:${e.status}`);case 404:return Promise.reject("頁面不存在:404");case 500:return Promise.reject("內部發生錯誤")}return e.data}),(function(e){return e.response&&e.response.status,Promise.reject(e.response)}));const f={class:"container-fluid",style:{margin:"0",padding:"0"}},m={class:"d-flex flex-wrap justify-content-center gap-2 w-100",style:{padding:"20px"}},g={class:"card card-fixed-wd"},y={class:"card-img-top"},v=["src"],h={class:"card-body"},w={key:0,class:"list-group list-group-flush"},b={key:0,class:"list-group-item"},x={key:1,class:"list-group-item",style:{color:"red"}},j={class:"list-group-item"},k={class:"list-group-item"},C={class:"card-footer d-flex flex-wrap justify-content-center"},P={__name:"CheckIn",setup(e){const p=c(),P=t(!1),$=t({lat:25.03418,lng:121.564087}),T=t("https://maps.google.com/maps?q=25.034180679449104,121.56408708529044&output=embed"),q=t(""),z=t("");function S(){P.value=!1,q.value="資料獲取中...","geolocation"in navigator?navigator.geolocation.getCurrentPosition((e=>{const t=Math.round(1e6*e.coords.latitude)/1e6,s=Math.round(1e6*e.coords.longitude)/1e6;$.value={lat:t,lng:s},T.value=`https://maps.google.com/maps?q=${t},${s}&output=embed`,q.value=""}),(e=>{i.warn(`無法取得位置資訊${e.code} ${e.message||""}`,{autoClose:4e3}),q.value="無法取得位置資訊"})):(i.warn("您的瀏覽器不支援地理定位功能。",{autoClose:4e3}),q.value="您的瀏覽器不支援地理定位功能"),new Promise((async(e,t)=>{try{const t=await fetch("https://api.ipify.org?format=json");e((await t.json()).ip)}catch(s){t(s.message||s.code)}})).then((e=>{z.value=e})).catch((e=>{z.value="error"})).finally((()=>{P.value=!0}))}return s((async()=>{})),(e,t)=>(u(),a("div",f,[o("div",m,[o("div",g,[o("div",y,[T.value.length>5?(u(),a("iframe",{key:0,width:"100%",height:"240",style:{border:"0"},loading:"lazy",allowfullscreen:"",referrerpolicy:"no-referrer-when-downgrade",src:T.value},null,8,v)):r("",!0)]),o("div",h,[t[3]||(t[3]=o("h4",{class:"card-title"},"打卡資訊",-1)),P.value?(u(),a("ul",w,[0==q.value.length?(u(),a("li",b,"GPS: "+n($.value.lat)+","+n($.value.lng),1)):r("",!0),q.value.length>0?(u(),a("li",x,"GPS: "+n(q.value),1)):r("",!0),o("li",j,"IP: "+n(z.value),1),o("li",k,[o("button",{type:"button",class:"btn btn-outline-primary fixed-size me-2",onClick:t[0]||(t[0]=e=>{window.Swal.fire({icon:"question",title:"送出打卡資訊",showDenyButton:!0,confirmButtonText:"確認",denyButtonText:"取消"}).then((e=>{if(e.isConfirmed){let e={location:[$.value.lat,$.value.lng],myip:z.value,ts:parseInt(Date.now()/1e3)};d(e).then((e=>{e.data.svts?(i.success("打卡成功",{autoClose:3e3}),liff.isLoggedIn()&&liff.sendMessages([{type:"text",text:"今日打卡資訊"}]).then((function(e){})).catch((function(e){}))):Swal.fire({title:"打卡失敗",icon:"error",text:`${e.error} ${e.extra.mesg||""}`})})).catch((e=>{Swal.fire({title:"打卡失敗，請再試一次",icon:"error"})}))}else e.isDenied}))})},"送出")])])):r("",!0)]),o("div",C,[o("button",{type:"button",class:"btn btn-outline-primary fixed-size me-2",onClick:t[1]||(t[1]=e=>S())},"打卡"),o("button",{type:"button",class:"btn btn-outline-primary fixed-size me-2",onClick:t[2]||(t[2]=e=>{l((()=>{p.push({name:"Home"})}))})},"回首頁")])])])]))}};export{P as default};
