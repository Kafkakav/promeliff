import{_ as a,u as e,r as s,o as t,l as o,a as l,b as n,c as i,d as c,e as d,f as r,w as f,g,t as u,h as m,i as p}from"./Dciesp7g.js";import{_ as b}from"./BIwg1ykr.js";import{s as h}from"./CdRfmGFb.js";const v="/promeliff/assets/BmIlvr5V.jpg";const I={class:"login"},L={key:0,class:"card"},y={key:1,class:"card"},k={class:"card-footer text-body-secondary"},C={key:0},x={key:1},E={key:2,class:"card"},w={class:"logo-banner"},R=a({__name:"lifflogin",setup(a){const R=e(),N=l(),T=s(null),j=s(!1),F=s(0),D=s("https://liff.line.me/2003978054-MNlNVly1");function B(a){if(!R.liffReady)return o.init({liffId:R.liffId}).then((()=>{})).catch((a=>{})),o.ready}function O(){let a=m("stepExtLogin");a&&911==a.yes?F.value=1:F.value=2}const P=()=>{R.fullscLoading=!0,R.liffReady?o.isInClient()?o.isLoggedIn()?(handleGASDID(),N.push({name:"Home"})):B():o.isLoggedIn()?(handleGASDID(),N.push({name:"Home"})):(j.value=!0,o.login({redirectUri:`${R.liffEPUrl}?longin=1`}),j.value=!1):B()},H=()=>new Promise(((a,e)=>{let s={liffId:R.liffId,accessToken:o.getAccessToken(),idToken:o.getIDToken()};var t;o.isLoggedIn(),(t=s,h({url:"/WdaG8atCBY/getoken",headers:{isToken:!1},method:"post",data:t})).then((s=>s.data&&s.data.token?(i("授權取得成功",{autoClose:4e3}),a(s.data)):(i("授權無法取得",{autoClose:4e3}),e({error:"no token acquired"})))).catch((a=>(R.liffReady=!1,i("授權失敗, 請關閉頁面",{autoClose:4e3}),e({error:"failed to get token"}))))}));return t((()=>{o.isLoggedIn()?H().then((a=>{R.setAuthToken(a),N.push({name:"Home"})})).catch((a=>{R.setAuthToken({token:"Fake-H99saGoCjD7ngi26sluCbzoSNLONBP8asx2abq2hfoENgK6n1mq4YuXJFAOnGRJC"}),N.push({name:"Home"})})).finally((()=>{O(),R.fullscLoading=!1})):(O(),R.fullscLoading=!1)})),n((()=>{R.fullscLoading=!0,R.liffReady||(B(),R.liffReady=!0),o.isInClient()?o.isLoggedIn()||window.Swal.fire({icon:"warning",title:"無法登入",text:"LINE LIFF 無法登入!",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"再試一次",denyButtonText:"關閉"}).then((a=>{a.isConfirmed?N.push({name:"Login"}):a.isDenied&&i("LINE LIFF 登入失敗",{autoClose:2e3})})):i("LINE LIFF 外部瀏覽器",{autoClose:2e3})})),(a,e)=>(p(),c("div",I,[0==F.value?(p(),c("div",L,e[1]||(e[1]=[r("img",{src:b,class:"card-img-top",alt:"PROME Title"},null,-1),r("p",{class:"logo-banner"},[r("img",{class:"object-fit-sm-contain border rounded-circle",style:{"max-width":"240px"},src:v,alt:"PROME Lion"})],-1)]))):d("",!0),1==F.value?(p(),c("div",y,[e[2]||(e[2]=r("img",{src:b,class:"card-img-top",alt:"PROME Title"},null,-1)),e[3]||(e[3]=r("div",{class:"card-body"},[r("h3",{class:"card-title"},[r("p",null,"訪問網站需要登入LINE，點選登入按鈕後繼續...")])],-1)),r("form",{class:"login-form",ref_key:"loginRef",ref:T,onSubmit:e[0]||(e[0]=f((()=>{}),["prevent"])),size:"large"},[r("p",{class:"logo-banner"},[r("img",{class:"imgbtn",src:"/promeliff/assets/CFYjjMVw.png",onClick:P,alt:"LIFF Login"})])],544),r("div",k,[j.value?(p(),c("span",x,"登 入 中 ...")):(p(),c("span",C,"請先登入"))])])):d("",!0),2==F.value?(p(),c("div",E,[e[4]||(e[4]=g('<img src="'+b+'" class="card-img-top" alt="PROME Title" data-v-7baba2a7><div class="d-flex flex-wrap justify-content-center" data-v-7baba2a7><p class="logo-banner" data-v-7baba2a7><img class="object-fit-sm-contain border rounded-circle" style="max-width:220px;" src="'+v+'" alt="PROME Lion" data-v-7baba2a7></p><p class="logo-banner" data-v-7baba2a7><img class="object-fit-sm-contain" style="max-width:220px;" src="/promeliff/assets/DHGIH-dO.png" alt="LINEBot:@poi1124d" data-v-7baba2a7></p></div><h3 class="logo-banner" data-v-7baba2a7>請用LINE掃QR Code加好友或在LINE聊天室裡開啟本網頁</h3>',3)),r("p",w,u(D.value),1)])):d("",!0)]))}},[["__scopeId","data-v-7baba2a7"]]);export{R as default};
