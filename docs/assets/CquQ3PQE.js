import{g as e,_ as a,u as s,r as t,o,l as n,a as r,b as l,c as i,d,e as c,f as u,w as f,h as m,t as g,i as p,j as b}from"./CpMbNNIF.js";import{_ as h}from"./BIwg1ykr.js";import{a as v}from"./fZjk1EK6.js";const y="/promeliff/assets/BmIlvr5V.jpg",I={401:"認證失敗，無法存取系統資源:401",403:"當前操作沒有權限:403",404:"存取資源不存在:404",default:"未知系統錯誤，請向管理員反應問題"};let L={show:!1};v.defaults.headers["Content-Type"]="application/json;charset=utf-8";const k=v.create({baseURL:"https://nozomiai.asuscomm.com/promeliff",timeout:12e3});k.interceptors.request.use((a=>(!(!1===(a.headers||{}).isToken)&&e()&&(a.headers.Authorization="Bearer "+e()),a)),(e=>{Promise.reject(e)})),k.interceptors.response.use((e=>{const a=e.data.code||200,s=I[a]||e.data.msg||I.default;return"blob"===e.request.responseType||"arraybuffer"===e.request.responseType?e.data:401===a?L.show?Promise.reject({error:"無效的session，或者會話已過期，請重新登錄。",code:a}):void(L.show=!0):500===a?Promise.reject(new Error(s)):200!==a?Promise.reject({error:"unknown error",code:a}):e.data}),(e=>{let a="x",{message:s}=e;return"Network Error"==s?s="後端連線異常":s.includes("timeout")?s="系統請求超時":s.includes("Request failed with status code")&&(a=s.substr(s.length-3),s=`系統${a}異常`),["400","403","404"].indexOf(a),e.response?Promise.reject({error:s,data:e.response.data||null,code:e.response.status||a}):Promise.reject(e)}));const w={class:"login"},j={key:0,class:"card"},x={key:1,class:"card"},C={class:"card-footer text-body-secondary"},E={key:0},T={key:1},R={key:2,class:"card"},P={class:"logo-banner"},N=a({__name:"lifflogin",setup(e){const a=s(),v=r(),I=t(null),L=t(!1),N=t(0),F=t("https://liff.line.me/2003978054-MNlNVly1");function B(e){if(!a.liffReady)return n.init({liffId:a.liffId}).then((()=>{})).catch((e=>{})),n.ready}function D(){let e=p("stepExtLogin");e&&911==e.yes?N.value=1:N.value=2}const O=()=>{a.fullscLoading=!0,a.liffReady?n.isInClient()?n.isLoggedIn()?(handleGASDID(),v.push({name:"Home"})):B():n.isLoggedIn()?(handleGASDID(),v.push({name:"Home"})):(L.value=!0,n.login({redirectUri:`${a.liffEPUrl}?longin=1`}),L.value=!1):B()},q=()=>new Promise(((e,s)=>{let t={liffId:a.liffId,accessToken:n.getAccessToken(),idToken:n.getIDToken()};var o;n.isLoggedIn(),(o=t,k({url:"/WdaG8atCBY/getoken",headers:{isToken:!1},method:"post",data:o})).then((a=>a.data&&a.data.token?(i("授權取得成功",{autoClose:4e3}),e(a.data)):(i("授權無法取得",{autoClose:4e3}),s({error:"no token acquired"})))).catch((e=>(a.liffReady=!1,i("授權失敗, 請關閉頁面",{autoClose:4e3}),s({error:"failed to get token"}))))}));return o((()=>{n.isLoggedIn()?q().then((e=>{a.setAuthToken(e),v.push({name:"Home"})})).catch((e=>{a.setAuthToken({token:"Fake-H99saGoCjD7ngi26sluCbzoSNLONBP8asx2abq2hfoENgK6n1mq4YuXJFAOnGRJC"}),v.push({name:"Home"})})).finally((()=>{D(),a.fullscLoading=!1})):(D(),a.fullscLoading=!1)})),l((()=>{a.fullscLoading=!0,a.liffReady||(B(),a.liffReady=!0),n.isInClient()?n.isLoggedIn()||window.Swal.fire({icon:"warning",title:"無法登入",text:"LINE LIFF 無法登入!",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"再試一次",denyButtonText:"關閉"}).then((e=>{e.isConfirmed?v.push({name:"Login"}):e.isDenied&&i("LINE LIFF 登入失敗",{autoClose:2e3})})):i("LINE LIFF 外部瀏覽器",{autoClose:2e3})})),(e,a)=>(b(),d("div",w,[0==N.value?(b(),d("div",j,a[1]||(a[1]=[u("img",{src:h,class:"card-img-top",alt:"PROME Title"},null,-1),u("p",{class:"logo-banner"},[u("img",{class:"object-fit-sm-contain border rounded-circle",style:{"max-width":"240px"},src:y,alt:"PROME Lion"})],-1)]))):c("",!0),1==N.value?(b(),d("div",x,[a[2]||(a[2]=u("img",{src:h,class:"card-img-top",alt:"PROME Title"},null,-1)),a[3]||(a[3]=u("div",{class:"card-body"},[u("h3",{class:"card-title"},[u("p",null,"訪問網站需要登入LINE，點選登入按鈕後繼續...")])],-1)),u("form",{class:"login-form",ref_key:"loginRef",ref:I,onSubmit:a[0]||(a[0]=f((()=>{}),["prevent"])),size:"large"},[u("p",{class:"logo-banner"},[u("img",{class:"imgbtn",src:"/promeliff/assets/CFYjjMVw.png",onClick:O,alt:"LIFF Login"})])],544),u("div",C,[L.value?(b(),d("span",T,"登 入 中 ...")):(b(),d("span",E,"請先登入"))])])):c("",!0),2==N.value?(b(),d("div",R,[a[4]||(a[4]=m('<img src="'+h+'" class="card-img-top" alt="PROME Title" data-v-7baba2a7><div class="d-flex flex-wrap justify-content-center" data-v-7baba2a7><p class="logo-banner" data-v-7baba2a7><img class="object-fit-sm-contain border rounded-circle" style="max-width:220px;" src="'+y+'" alt="PROME Lion" data-v-7baba2a7></p><p class="logo-banner" data-v-7baba2a7><img class="object-fit-sm-contain" style="max-width:220px;" src="/promeliff/assets/DHGIH-dO.png" alt="LINEBot:@poi1124d" data-v-7baba2a7></p></div><h3 class="logo-banner" data-v-7baba2a7>請用LINE掃QR Code加好友或在LINE聊天室裡開啟本網頁</h3>',3)),u("p",P,g(F.value),1)])):c("",!0)]))}},[["__scopeId","data-v-7baba2a7"]]);export{N as default};
