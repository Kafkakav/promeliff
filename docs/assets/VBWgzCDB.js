import{_ as e,u as a,r as s,o as l,l as t,a as n,b as o,c as i,d as c,e as r,f as d,w as f,g,t as u,h as m,i as p,j as y}from"./BpdCzYEz.js";import{_ as I}from"./BIwg1ykr.js";const h="/promeliff/assets/BmIlvr5V.jpg",v={class:"login"},b={key:0,class:"card"},L={key:1,class:"card"},k={class:"card-footer text-body-secondary"},x={key:0},C={key:1},E={key:2,class:"card"},w={class:"logo-banner"},R=e({__name:"lifflogin",setup(e){const R=a(),N=n(),j=s(null),F=s(!1),T=s(0),D=s("https://liff.line.me/2003978054-MNlNVly1");function O(e){if(!R.liffReady)return t.init({liffId:R.liffId}).then((()=>{})).catch((e=>{})),t.ready}function P(){let e=p("stepExtLogin");e&&911==e.yes?T.value=1:T.value=2}const B=()=>{if(R.fullscLoading=!0,R.liffReady)if(t.isInClient())t.isLoggedIn()?(handleGASDID(),N.push({name:"Home"})):O();else if(t.isLoggedIn())handleGASDID(),N.push({name:"Home"});else{F.value=!0;let e="";null!=R.replyQry&&(e="&replyQry=",e+=encodeURIComponent(JSON.stringify(R.replyQry))),t.login({redirectUri:`${R.liffEPUrl}?login=ext${e}`}),F.value=!1}else O()};return l((()=>{t.isLoggedIn()?new Promise(((e,a)=>{let s={liffId:R.liffId,accessToken:t.getAccessToken(),idToken:t.getIDToken()};t.isLoggedIn(),m(s).then((s=>s.data&&s.data.token?(i("授權取得成功",{autoClose:4e3}),e(s.data)):(i("授權無法取得",{autoClose:4e3}),a({error:"no token acquired"})))).catch((e=>(R.liffReady=!1,i("授權失敗, 請關閉頁面",{autoClose:4e3}),a({error:"failed to get token"}))))})).then((e=>{R.setAuthToken(e),N.push({name:"Home"})})).catch((e=>{R.setAuthToken({token:"Fake-H99saGoCjD7ngi26sluCbzoSNLONBP8asx2abq2hfoENgK6n1mq4YuXJFAOnGRJC",ts:parseInt(Date.now()/1e3)+3600}),N.push({name:"Home"})})).finally((()=>{P(),R.fullscLoading=!1})):(P(),R.fullscLoading=!1)})),o((()=>{R.fullscLoading=!0,R.liffReady||(O(),R.liffReady=!0),t.isInClient()?t.isLoggedIn()||window.Swal.fire({icon:"warning",title:"無法登入",text:"LINE LIFF 無法登入!",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"再試一次",denyButtonText:"關閉"}).then((e=>{e.isConfirmed?N.push({name:"Login"}):e.isDenied&&i("LINE LIFF 登入失敗",{autoClose:2e3})})):i("LINE LIFF 外部瀏覽器",{autoClose:2e3})})),(e,a)=>(y(),c("div",v,[0==T.value?(y(),c("div",b,a[1]||(a[1]=[d("img",{src:I,class:"card-img-top",alt:"PROME Title"},null,-1),d("p",{class:"logo-banner"},[d("img",{class:"object-fit-sm-contain border rounded-circle",style:{"max-width":"240px"},src:h,alt:"PROME Lion"})],-1)]))):r("",!0),1==T.value?(y(),c("div",L,[a[2]||(a[2]=d("img",{src:I,class:"card-img-top",alt:"PROME Title"},null,-1)),a[3]||(a[3]=d("div",{class:"card-body"},[d("h3",{class:"card-title"},[d("p",null,"訪問網站需要登入LINE，點選登入按鈕後繼續...")])],-1)),d("form",{class:"login-form",ref_key:"loginRef",ref:j,onSubmit:a[0]||(a[0]=f((()=>{}),["prevent"])),size:"large"},[d("p",{class:"logo-banner"},[d("img",{class:"imgbtn",src:"/promeliff/assets/CFYjjMVw.png",onClick:B,alt:"LIFF Login"})])],544),d("div",k,[F.value?(y(),c("span",C,"登 入 中 ...")):(y(),c("span",x,"請先登入"))])])):r("",!0),2==T.value?(y(),c("div",E,[a[4]||(a[4]=g('<img src="'+I+'" class="card-img-top" alt="PROME Title" data-v-b13996fe><div class="d-flex flex-wrap justify-content-center" data-v-b13996fe><p class="logo-banner" data-v-b13996fe><img class="object-fit-sm-contain border rounded-circle" style="max-width:220px;" src="'+h+'" alt="PROME Lion" data-v-b13996fe></p><p class="logo-banner" data-v-b13996fe><img class="object-fit-sm-contain" style="max-width:220px;" src="/promeliff/assets/DHGIH-dO.png" alt="LINEBot:@poi1124d" data-v-b13996fe></p></div><h3 class="logo-banner" data-v-b13996fe>請用LINE掃QR Code加好友或在LINE聊天室裡開啟本網頁</h3>',3)),d("p",w,u(D.value),1)])):r("",!0)]))}},[["__scopeId","data-v-b13996fe"]]);export{R as default};
